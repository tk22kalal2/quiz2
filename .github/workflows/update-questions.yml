name: Update Questions and Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # Change this to your default branch if different
  schedule:
    - cron: '0 0 * * *'  # Runs once daily; adjust as needed

jobs:
  update-questions:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Create src Directory
      run: mkdir -p src

    - name: Fetch Questions from OpenAI
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      run: |
        echo "Fetching questions from OpenAI..."
        
        # Create a JS file with questions
        echo "const questions = [" > src/questions.js
        
        for i in {1..3}; do
          response=$(curl -s -X POST https://api.openai.com/v1/completions \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer $OPENAI_API_KEY" \
          -d '{
            "model": "text-davinci-003",
            "prompt": "Generate an MBBS multiple-choice question with 4 options and the correct answer indicated.",
            "max_tokens": 100
          }')
          
          # Parse the response and append to questions file
          question_text=$(echo $response | jq -r '.choices[0].text')
          echo "{ text: \"$question_text\" }," >> src/questions.js
        done

        echo "]; export default questions;" >> src/questions.js

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./  # Adjust this if you have a build directory
